<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Graph (SVG Export)</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <button id="download">Download SVG</button>
    <svg id="graph" width="600" height="400"></svg>

    <script>
        const nodes = [
            { id: "A", url: "https://example.com/A" },
            { id: "B", url: "https://example.com/B" },
            { id: "C", url: "https://example.com/C" }
        ];

        const links = [
            { source: "A", target: "B" },
            { source: "B", target: "C" },
            { source: "A", target: "C" }
        ];

        const width = 600, height = 400;
        const svg = d3.select("#graph");

        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id).distance(100))
            .force("charge", d3.forceManyBody().strength(-300))
            .force("center", d3.forceCenter(width / 2, height / 2));

        // Draw edges
        svg.append("g")
            .attr("stroke", "#aaa")
            .attr("stroke-width", 2)
            .selectAll("line")
            .data(links)
            .enter().append("line")
            .attr("pointer-events", "none");

        // Create groups for each node (circle + text together)
        const nodeGroup = svg.append("g")
            .selectAll("g")
            .data(nodes)
            .enter().append("g");

        // Wrap nodes inside <a> to make them clickable in the exported SVG
        const linkGroup = nodeGroup.append("a")
            .attr("xlink:href", d => d.url)  // Make the node a clickable link
            .attr("target", "_blank");      // Open in a new tab

        // Append circles inside <a>
        linkGroup.append("circle")
            .attr("r", 20)
            .attr("fill", "steelblue");

        // Append text inside <a>
        linkGroup.append("text")
            .attr("fill", "white")
            .attr("font-size", "14px")
            .attr("font-weight", "bold")
            .attr("text-anchor", "middle")
            .attr("dy", ".35em")
            .text(d => d.id);

        // Apply simulation updates
        simulation.on("tick", () => {
            svg.selectAll("line")
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            nodeGroup
                .attr("transform", d => `translate(${d.x},${d.y})`);
        });

        // Function to download SVG
        document.getElementById("download").addEventListener("click", function () {
            const serializer = new XMLSerializer();
            const svgData = serializer.serializeToString(document.getElementById("graph"));
            const blob = new Blob([svgData], { type: "image/svg+xml;charset=utf-8" });
            const url = URL.createObjectURL(blob);

            const link = document.createElement("a");
            link.href = url;
            link.download = "graph.svg";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });
    </script>
</body>
</html>